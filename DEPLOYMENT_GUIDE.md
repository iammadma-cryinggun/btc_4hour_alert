# V7.0交易系统 - 部署文档

## 系统概述

V7.0交易系统是基于非线性动力学理论的完整实盘交易系统，结合了：
- **信号计算**：继承v4.2数学家策略的FFT+Hilbert物理计算
- **交易逻辑**：V7.0 Combat Robust策略
- **交互功能**：Telegram实时通知和命令
- **状态管理**：持久化存储

## 回测表现

- **总收益率**: 85.01%
- **最大回撤**: -31.8%
- **止盈率**: 90.2%
- **平均持仓周期**: 4.3个周期（约17小时）
- **早期退出率**: 4.5%（vs V5.1的83.7%）

## 核心特性

### 1. 信号计算（继承v4.2）

- FFT低通滤波（保留前8个系数）
- Hilbert变换 → 张力
- 张力标准化
- 加速度计算（张力的一阶导数）
- 市场状态诊断（SINGULARITY、OSCILLATION）

### 2. V7.0交易逻辑

#### 惯性保护区（T0-T2）
- 前8小时（2个周期）只触发ATR硬止损
- 屏蔽所有其他熔断机制

#### ATR动态止损
- 14周期ATR计算
- 1.5倍ATR止损距离
- 不随仓位大小调整

#### 动能衰减判断
- 连续4个周期监控
- 连续3个周期下降
- 跌幅<70%触发

#### 张力过载/置信度崩塌
- |张力| > 1.2 → 平仓
- 置信度 < 0.3 → 平仓

#### 时间窗口到期
- 最多持有5个周期（20小时）
- 自动平仓

### 3. Telegram交互

- 新信号通知
- 开仓/平仓通知
- 系统状态查询
- 手动平仓命令

## 文件结构

```
deployment/
├── v70_trader_main.py          # 主程序（第一部分）
├── v70_trader_runner.py         # 主程序（第二部分 + 启动逻辑）
├── .env.example                 # 环境变量示例
├── DEPLOYMENT_GUIDE.md          # 部署文档（本文件）
├── v70_trader_state.json        # 系统状态（运行时生成）
├── v70_trader.log               # 日志文件（运行时生成）
└── requirements.txt             # 依赖包列表
```

## 快速开始

### 1. 安装依赖

```bash
cd C:\Users\Martin\Downloads\机器人\趋势判断\V4.3\deployment
pip install -r requirements.txt
```

### 2. 配置环境变量

```bash
# 复制示例配置
cp .env.example .env

# 编辑 .env 文件，修改 Telegram Token 和 Chat ID
notepad .env
```

### 3. 测试运行

```bash
# 测试模式（执行一次信号检查）
python v70_trader_runner.py test
```

### 4. 正式启动

```bash
# 正常启动
python v70_trader_runner.py
```

### 5. Telegram命令

发送命令到Telegram Bot：

- `/status` - 查看系统状态
- `/test` - 执行测试信号检查
- `/close` - 手动平仓（如果有持仓）

## 运行频率

- **信号检查**: 每4小时（在4H K线收盘时）
- **仓位检查**: 每1小时（监控止损）
- **状态报告**: 每6小时（自动发送）

## 风险提示

1. **本系统仅供学习研究使用**
2. **实盘交易存在风险，请谨慎操作**
3. **建议先在模拟环境测试**
4. **回测表现不代表未来收益**

## 故障排除

### 问题1：代理连接失败

**错误**: `requests.exceptions.ProxyError`

**解决**:
- 检查代理是否正常运行
- 修改配置文件中的代理设置
- 如果不需要代理，设置 `proxy_enabled = False`

### 问题2：Telegram消息发送失败

**错误**: `[Telegram] 发送失败`

**解决**:
- 检查 Telegram Token 和 Chat ID 是否正确
- 确认 Bot 已被添加到群组
- 检查网络连接

### 问题3：数据获取失败

**错误**: `获取BTC数据失败`

**解决**:
- 检查网络连接
- 确认 Binance API 可访问
- 如果使用代理，确认代理配置正确

## 系统监控

### 日志文件

所有操作都会记录到 `v70_trader.log`，包括：
- 信号检查日志
- 开仓/平仓日志
- 异常错误日志

### 状态文件

系统状态保存在 `v70_trader_state.json`，包括：
- 当前持仓状态
- 止损价格
- 交易历史
- 统计数据

系统重启时会自动加载状态，确保 continuity。

## 更新日志

### V7.0 (2026-01-13)

- ✅ 继承v4.2的信号计算逻辑
- ✅ 实现V7.0 Combat Robust交易策略
- ✅ 集成Telegram通知和交互
- ✅ 状态持久化存储
- ✅ 定时任务调度
- ✅ 完整的日志记录

## 技术支持

如有问题，请查看：
1. 日志文件 `v70_trader.log`
2. 回测结果 `backtest_v70_summary.json`
3. 交易记录 `backtest_v70_trades.csv`

## 许可证

仅供学习和研究使用。实盘交易风险自负。

---

**生成时间**: 2026-01-13
**版本**: V7.0 Production
**作者**: Claude + User
